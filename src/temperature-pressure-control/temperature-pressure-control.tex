\input{../include/preample-jsarticle}
\input{../include/page-rayout}
\input{../include/usepackage}
\input{../include/macro}
\input{../include/begin}

\title{温度・圧力制御}
\maketitle
\section{能勢・Andersenの方法}
温度と圧力を制御して定温定圧アンサンブルを得るには, 能勢の方法とAndersenの方法を組み合わせ, 
物理系に熱浴とピストンの両方を付ければよい. 
拡張系のハミルトニアンは物理系のハミルトニアンに熱浴とピストンの自由度を付け足した
\begin{equation}
 \mathcal{H}_{\mathrm{NA}}
  =
  \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{\prime 2}}{2 m_{i} s^{2} V^{\frac{2}{3}}}
  + U(V^{\frac{1}{3}}\Tilde{\bm{r}}_{i}^{\prime})
  + \frac{p_{s}^{2}}{2Q} + g k_{B}T_{\mathrm{eq}} \ln s
  + \frac{p_{V}^{2}}{2W} + P_{\mathrm{eq}} V
 \label{eq:NoseAndersen1}
\end{equation}
で与えられる. ここでは時間と空間のスケールを両方行っている. 
時間スケールされた変数には$^{\prime}$, 空間スケールされた変数には$\Tilde{}$をつける. 
物理系の変数と拡張系の仮想変数は以下の関係式で結ばれている. 
\begin{alignat}{2}
 &\bm{r}_{i} &&= V^{\frac{1}{3}} \Tilde{\bm{r}}_{i}
                 = V^{\frac{1}{3}} \Tilde{\bm{r}}_{i}^{\prime} 
 \label{eq:NoseAndersen2.1}
 \\
 &\bm{p}_{i} &&= \frac{\bm{p}_{i}^{\prime}}{s}
                 = \frac{\Tilde{\bm{p}}_{i}}{V^{\frac{1}{3}}}
                 = \frac{\Tilde{\bm{p}}_{i}^{\prime}}{s V^{\frac{1}{3}}} 
 \label{eq:NoseAndersen2.2}
 \\
 &t &&= \int ^{t^{\prime}} \frac{dt^{\prime}}{s}
 \label{eq:NoseAndersen2.3}
\end{alignat}
ハミルトニアンより
$\Tilde{\bm{r}}_{i}^{\prime}$,$\Tilde{\bm{p}}_{i}^{\prime}$,$s$,$p_{s}$,$V$,$p_{V}$
についての運動方程式を求めると, 
\begin{alignat}{3}
 \frac{d \Tilde{\bm{r}}_{i}^{\prime}}{d t^{\prime}}
   &= &&\frac{\partial \mathcal{H}_{\mathrm{NA}}}{\partial \Tilde{\bm{p}}_{i}^{\prime}}
  &&=   \frac{\Tilde{\bm{p}}_{i}^{\prime}}{m_{i} s^{2} V^{\frac{2}{3}}}
 \label{eq:NoseAndersen3.1}
 \\
 \frac{d \Tilde{\bm{p}}_{i}^{\prime}}{d t^{\prime}}
  & = - &&\frac{\partial \mathcal{H}_{\mathrm{NA}}}{\partial \Tilde{\bm{r}}_{i}^{\prime}}
  &&= - \frac{\partial U}{\partial \Tilde{\bm{r}}_{i}^{\prime}}
 \label{eq:NoseAndersen3.2}
 \\
 \frac{d s}{d t^{\prime}}
  &= && \frac{\partial \mathcal{H}_{\mathrm{NA}}}{\partial p_{s}}
 &&=    \frac{p_{s}}{Q}
 \label{eq:NoseAndersen3.3}
 \\
 \frac{d p_{s}}{d t^{\prime}}
  &= - && \frac{\partial \mathcal{H}_{\mathrm{NA}}}{\partial s}
 &&= \frac{1}{s}\left(
                 \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{\prime2}}{m_{i} s^{2} V^{\frac{2}{3}}}
                 - g k_{B} T_{\mathrm{eq}}
                 \right)
 \label{eq:NoseAndersen3.4}
 \\
 \frac{d V}{d t^{\prime}}
  &= &&\frac{\partial \mathcal{H}_{\mathrm{NA}}}{\partial p_{V}}
 &&=   \frac{p_{V}}{W}
 \label{eq:NoseAndersen3.5}
 \\
 \frac{d p_{V}}{d t^{\prime}}
  &= - &&\frac{\partial \mathcal{H}_{\mathrm{NA}}}{\partial V}
  &&= \frac{1}{3V}
   \left(
         \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{\prime 2}}{m_{i} s^{2} V^{\frac{2}{3}}}
       + \sum_{i=1}^{N} \bm{F}_{i} \cdot \bm{r}_{i}
   \right)
   - P_{\mathrm{eq}}
 \label{eq:NoseAndersen3.6}
\end{alignat}
となる. さらに実時間$t$で時間発展するように書き換える. 
座標と運動量をそれぞれ$\Tilde{\bm{r}}_{i}^{\prime},\Tilde{\bm{p}}_{i}^{\prime}$
から$\bm{r}_{i},\bm{p}_{i}$へと変数変換すると, 
\begin{alignat}{2}
 &\frac{d \bm{r}_{i}}{d t}
 &&=
 \frac{\bm{p}_{i}}{m_{i}} + \frac{\dot{V}}{3V}\bm{r}_{i}
 \label{eq:NoseAndersen4.1}
 \\
 &\frac{d \bm{p}_{i}}{d t}
 &&=
  \bm{F}_{i} - \left( \frac{\dot{s}}{s} + \frac{\dot{V}}{3V} \right) \bm{p}_{i}
 \label{eq:NoseAndersen4.2}
 \\
 &\frac{d s}{d t}
 &&=
 s \frac{p_{s}}{Q}
 \label{eq:NoseAndersen4.3}
 \\
 &\frac{d p_{s}}{d t}
 &&=
 \sum_{i=1}^{N} \frac{\bm{p}_{i}^{2}}{m_{i}} - g k_{B} T_{\mathrm{eq}}
 \label{eq:NoseAndersen4.4}
 \\
 &\frac{d V}{d t}
 &&= s \frac{p_{V}}{W}
 \label{eq:NoseAndersen4.5}
 \\
 &\frac{d p_{V}}{d t}
 &&= s \left\{
       \frac{1}{3V}
       \left(
             \sum_{i=1}^{N} \frac{\bm{p}_{i}^{2}}{m_{i}}
           + \sum_{i=1}^{N} \bm{F}_{i} \cdot \bm{r}_{i}
       \right)
       - P_{\mathrm{eq}}
       \right\}
 \label{eq:NoseAndersen4.6}
\end{alignat}
を得る. 
運動方程式(\ref{eq:NoseAndersen3.1})-(\ref{eq:NoseAndersen3.6})
あるいは(\ref{eq:NoseAndersen4.1})-(\ref{eq:NoseAndersen4.6})にしたがって
時間発展させることにより, 定温定圧アンサンブルの分子動力学シミュレーションを行うことができる. 
ここでも, 粒子の運動量と体積にフィードバックがかかってそれぞれ温度と圧力を制御していることがわかる. 
物理系の瞬間温度
\begin{equation}
 T(t) = \frac{1}{g k_{B}} \sum_{i=1}^{N} \frac{\bm{p}_{i}^2}{m_{i}}
 \label{eq:NoseAndersen5}
\end{equation}
を用いて式(\ref{eq:NoseAndersen4.3}), (\ref{eq:NoseAndersen4.4})を書き換えると, 
\begin{equation}
 \frac{d}{d t} \left( \frac{\dot{s}}{s} \right)
  = \frac{g k_{B}}{Q} ( T(t) - T_{\mathrm{eq}})
 \label{eq:NoseAndersen6}
\end{equation}
を得る. 
ここで$\dot{s}/s$は式(\ref{eq:NoseAndersen4.2})において, 運動量に対する抵抗係数のような働きをする. 
瞬間温度$T(t)$が設定温度$T_{\mathrm{eq}}$より高い時, $\bm{p}_{i}$は減少する方向に値が変化し, 
温度を低くする. 
一方で, 瞬間温度$T(t)$が設定温度$T_{\mathrm{eq}}$より低い時, $\bm{p}_{i}$は増加する方向
に値が変化し, 温度を高くする. 
また, 瞬間圧力
\begin{equation}
 P(t)
  = \frac{1}{3V}
  \left(
   \sum_{i}^{N} \frac{\bm{p}_{i}^{2}(t)}{m_{i}}
 + \sum_{i}^{N} \bm{F}_{i}(t) \cdot \bm{r}_{i}(t)
  \right)
 \label{eq:NoseAndersen7}
\end{equation}
を用いて, 式（\ref{eq:NoseAndersen4.6})を書き換えると, 
\begin{equation}
 \frac{d p_{V}}{d t}
  = s \left(
       P(t) - P_{\mathrm{eq}}
      \right)
 \label{eq:NoseAndersen8}
\end{equation}
を得る. 
瞬間圧力$P(t)$が設定圧力$P_{\mathrm{eq}}$より高い時, 体積$V$が膨張する方向に値が変化して圧力を下げる. 
瞬間圧力$P(t)$が設定圧力$P_{\mathrm{eq}}$より低い時, 体積$V$が圧縮する方向に値が変化して圧力は高める. 
このように瞬間温度と瞬間圧力から粒子の運動量と系の体積にフィードバックをかけることで, 
設定温度$T_{\mathrm{eq}}$と設定圧力$P_{\mathrm{eq}}$を達成する. 

\subsection{定温定圧アンサンブルが実現することの証明}
ハミルトニアン$\mathcal{H}_{\mathrm{NA}}$は一定値$E$をとり, 
拡張系全体ではミクロカノニカルアンサンブルになる. 
そのため, 拡張系全体の分配関数は
\begin{align}
 Y
  &=
  \int_{0}^{\infty} d s
  \int_{-\infty}^{\infty} d p_{s}
  \int_{0}^{\infty} d V
  \int_{-\infty}^{\infty} d p_{V}
  \int d \Tilde{\bm{r}}^{\prime}
  \int d \Tilde{\bm{p}}^{\prime}
  \notag
  \\
  &~~~~\times
  \delta \left\{
	 \mathcal{H}_{0} \left( V^{\frac{1}{3}} \Tilde{\bm{r}}^{\prime},
			 \frac{\Tilde{\bm{p}}^{\prime}}{s V^{\frac{1}{3}}} 
	                 \right)
        + \frac{p_{s}^{2}} {2Q} + g k_{B} T_{\mathrm{eq}} \ln s
        + \frac{p_{V}^{2}} {2W} + P_{\mathrm{eq}} V
        - E
         \right\}
 \label{eq:NoseAndersen9}
\end{align}
ここで, 仮想系の変数から物理系の変数へと変数変換
$\bm{r}_{i}=V^{\frac{1}{3}}\Tilde{\bm{r}}_{i}^{\prime}$,
$\bm{p}_{i}=\Tilde{\bm{p}}_{i}^{\prime} / V^{\frac{1}{3}}$
を行う. $\Tilde{\bm{r}}_{i}^{\prime}$, $\Tilde{\bm{p}}_{i}^{\prime}$の微分が
\begin{equation}
 d \Tilde{\bm{r}}^{\prime} d \Tilde{\bm{p}}^{\prime}
  = s^{3N} d \bm{r} d \bm{p}
 \label{eq:NoseAndersen10}
\end{equation}
であることから, 分配関数は, 
\begin{align}
 Y
  &=
  \int_{0}^{\infty} d s
  \int_{-\infty}^{\infty} d p_{s}
  \int_{0}^{\infty} d V
  \int_{-\infty}^{\infty} d p_{V}
  \int d \bm{r}
  \int d \bm{p}
  \notag
  \\
  &~~~~\times s^{3N}
  \delta \left\{
	 \mathcal{H}_{0} \left(\bm{r},\bm{p} \right)
        + \frac{p_{s}^{2}} {2Q} + g k_{B} T_{\mathrm{eq}} \ln s
        + \frac{p_{V}^{2}} {2W} + P_{\mathrm{eq}} V
        - E
         \right\}
 \label{eq:NoseAndersen11}
\end{align}
とかける. ここでディラックのデルタ関数$\delta (x)$に関する恒等式
\begin{equation}
 \delta\left( f(s) \right)
  = \frac{\delta (s - s_{0})}{| f^{\prime}(s) |} ~~~
  \text{但し} f(s_{0})=0
 \label{eq:NoseAndersen12}
\end{equation}
を適用する. 今の場合, 
\begin{equation}
 f(s)
  = \mathcal{H}_{0} \left(\bm{r}, \bm{p}\right)
  + \frac{p_{s}^{2}}{2Q} + g k_B T_{\mathrm{eq}} \ln s
  + \frac{p_{V}^{2}}{2W} + P_{\mathrm{eq}} V
  - E
 \label{eq:NoseAndersen13}
\end{equation}
であるので, $f(s)=0$となるような$s(\equiv s_{0})$は
\begin{equation}
 s_{0}
  = \exp \left\{
         \frac{
               E - \mathcal{H}_{0} \left(\bm{r}, \bm{p} \right)
	      - \frac{p_{s}^2}{2Q} - \frac{p_{V}^{2}}{2W}
	      -  P_{\mathrm{eq}} V
	      }
              {g k_{B} T_{\mathrm{eq}}}
	 \right\}
 \label{eq:NoseAndersen14}
\end{equation}
である. 
さらに, $f^{\prime}(s)=g k_{B} T_{\mathrm{eq}} / s$であるので, 
分配関数中の$s$に関する積分を実行すると
\begin{align}
Y
 &=
 \int_{0}^{\infty} d s
 \int_{-\infty}^{\infty} d p_{s}
 \int_{0}^{\infty} d V
 \int_{-\infty}^{\infty} d p_{V}
 \int d \bm{r}
 \int d \bm{p} ~
 \frac{s^{3N+1}}{g k_{B} T_{\mathrm{eq}}}
 \delta (s - s_{0})
 \notag
 \\
 &=
 \int_{-\infty}^{\infty} d p_{s}
 \int_{0}^{\infty} d V
 \int_{-\infty}^{\infty} d p_{V}
 \int d \bm{r}
 \int d \bm{p}
 \notag
 \\
 &~~~~\times
 \frac{1}{g k_{B} T_{\mathrm{eq}}}
 \exp \left[
         \frac{3N+1}{g k_{B} T_{\mathrm{eq}}}
         \left\{
                E - \mathcal{H}_{0} \left(\bm{r}, \bm{p} \right)
 	      - \frac{p_{s}^2}{2Q} - \frac{p_{V}^{2}}{2W}
	      -  P_{\mathrm{eq}} V
         \right\}
	 \right]
 \label{eq:NoseAndersen15}
\end{align}
となる. 
$g=3N+1$とすると
\begin{align}
 Y
 &=
 \int_{-\infty}^{\infty} d p_{s}
 \int_{-\infty}^{\infty} d p_{V} ~
 \frac{1}{g k_{B} T_{\mathrm{eq}}}
 \exp \left\{
      \frac{E  - \frac{p_{s}^2}{2Q} - \frac{p_{V}^{2}}{2W}}{k_{B} T_{\mathrm{eq}}}
      \right\}
 \notag
 \\
 &~~~~\times
 \int_{0}^{\infty} d V
 \int d \bm{r}
 \int d \bm{p} ~
 \exp \left\{
           - \frac{ \mathcal{H}_{0} \left(\bm{r}, \bm{p} \right)
                   + P_{\mathrm{eq}} V
             }
             {k_{B} T_{\mathrm{eq}}}
        \right\}
\label{eq:NoseAndersen16}
\end{align}
式(\ref{eq:NoseAndersen16})の1行目は$p_{s}$, $p_{V}$について
ガウス積分することが可能なので定数となる. 
したがって, 仮想時間$t^{\prime}$で平均する場合には$g=3N+1$とするれば, 定温定圧アンサンブルを得られる. 
実時間$t$でサンプルする場合には, $g=3N$とすることで定温定圧アンサンブルを得ることができる. 
これは, 能勢・Hoover熱浴の時と同様の方法で示すことができる. 

\subsection{能勢・Andersenの方法の時間発展}
能勢・Andersenの方法を使って温度・圧力を制御するアルゴリズムを使用するには, シミュレーションセルの1辺の長さ
$L = V^{\frac{1}{3}}$でスケールした座標$\Tilde{\bm{r}}_{i}$と
運動量$\Tilde{\bm{p}}_{i}$を用いると便利である. 
スケールした座標$\Tilde{\bm{r}}_{i}$と運動量$\Tilde{\bm{p}}_{i}$を
使って能勢・Andersenの運動方程式(\ref{eq:NoseAndersen3.1})-(\ref{eq:NoseAndersen3.6})
あるいは(\ref{eq:NoseAndersen4.1})-(\ref{eq:NoseAndersen4.6})を書き換え, さらに
熱浴粒子の運動方程式をHoover形式に書き直すと, 
\begin{alignat}{2}
 &\frac{d \Tilde{\bm{r}}_{i}}{d t}
 &&=
 \frac{\Tilde{\bm{p}}_{i}}{m_{i} V^{\frac{2}{3}}}
 \label{eq:NoseAndersen17.1}
 \\
 &\frac{d \Tilde{\bm{p}}_{i}}{d t}
 &&=
 V^{\frac{1}{3}}\bm{F}_{i} - \zeta \Tilde{\bm{p}}_{i}
 \label{eq:NoseAndersen17.2}
 \\
 &\frac{d V}{d t}
 &&= s \frac{p_{V}}{W}
 \label{eq:NoseAndersen17.3}
 \\
 &\frac{d p_{V}}{d t}
 &&= s
    \left\{
           \frac{1}{3V}
      \left(
         \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}}
       + \sum_{i=1}^{N} \bm{F}_{i} \cdot \bm{r}_{i}
      \right)
    - P_{\mathrm{eq}}
    \right\}
 \label{eq:NoseAndersen17.4}
 \\
 &\frac{d \eta}{d t}
 &&=
 \zeta
 \label{eq:NoseAndersen17.5}
 \\
 &\frac{d \zeta}{d t}
 &&=
 \frac{1}{Q}
 \left(
 \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}} - g k_{B} T_{\mathrm{eq}}
 \right)
 \label{eq:NoseAndersen17.6}
\end{alignat}
となる. ただし, 
\begin{align}
 &\ln s = \eta
 \label{eq:NoseAndersen18.1}
 \\
 &\bm{r}_{i} = V^{\frac{1}{3}} \Tilde{\bm{r}}_{i}
 \label{eq:NoseAndersen18.2}
\end{align}
の関係があることに注意する. 
運動方程式(\ref{eq:NoseAndersen17.1})-(\ref{eq:NoseAndersen17.6})より, 
位相空間は($\Tilde{\bm{r}}$,$\Tilde{\bm{p}}$,$V$,$p_{V}$,$\eta$,$\zeta$)で張られる. 
ある物理量$A(\Tilde{\bm{r}},\Tilde{\bm{p}},V,p_{V},\eta,\zeta)$の時間発展を記述する演算子
$\mathcal{D}$を
\begin{equation}
 \dot{A}(\Tilde{\bm{r}},\Tilde{\bm{p}},V,p_{V},\eta,\zeta) = \mathcal{D} A
 \label{eq:NoseAndersen19}
\end{equation}
\begin{equation}
 \mathcal{D}
  \equiv
  \sum_{i=1}^{N} \frac{d \Tilde{\bm{r}}_{i}}{d t} \cdot \frac{\partial}{\partial \Tilde{\bm{r}}_{i}}
  +
  \sum_{i=1}^{N} \frac{d \Tilde{\bm{p}}_{i}}{d t} \cdot \frac{\partial}{\partial \Tilde{\bm{p}}_{i}}
  +
  \frac{d V}{d t} \frac{\partial}{\partial V}
  +
  \frac{d p_{V}}{d t} \frac{\partial}{\partial p_{V}}
  +
  \frac{d \eta}{d t} \frac{\partial}{\partial \eta}
  +
  \frac{d \zeta}{d t} \frac{\partial}{\partial \zeta}
 \label{eq:NoseAndersen20}
\end{equation}
のように導入すると, 微分方程式の形式解は
\begin{equation}
 A(t + \Delta t) = e^{\mathcal{D} \Delta t} A(t)
\end{equation}
とかける. 
このままでは時間発展演算子$e^{\mathcal{D} \Delta t}$は数値積分できない. 
そこで, 運動方程式(\ref{eq:NoseAndersen17.1})-(\ref{eq:NoseAndersen17.6})を
式(\ref{eq:NoseAndersen20})に代入する. 
\begin{align}
 \mathcal{D}
 &=
  \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}}{ m_{i} V^{\frac{2}{3}}}
  \cdot \frac{\partial}{\partial \Tilde{\bm{r}}_{i}}
  +
  \sum_{i=1}^{N}
  \left(
   V^{\frac{1}{3}} \bm{F}_{i} - \zeta \Tilde{\bm{p}}_{i}
  \right)
  \cdot \frac{\partial}{\partial \Tilde{\bm{p}}_{i}}
  +
  s \frac{p_{V}}{W} \frac{\partial}{\partial V} 
  \notag
  \\ 
  &~~~~
  +
  s \left\{
     \frac{1}{3V} \left(
		   \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}}
		   + \sum_{i=1}^{N} \bm{F}_{i} \cdot \bm{r}_{i}
		  \right)
     - P_{\mathrm{eq}}
    \right\}
  \frac{\partial}{\partial p_{V}}
  +
  \zeta \frac{\partial}{\partial \eta}
  \notag
  \\ &~~~~
  +
  \frac{1}{Q} \left(
                    \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}}
                   - g k_{B} T_{\mathrm{eq}}
	       \right)
  \frac{\partial}{\partial \zeta}
 \label{eq:NoseAndersen21}
\end{align}
続いて, 演算子$\mathcal{D}$を以下のように分割する. 
\begin{alignat}{2}
 &\mathcal{D}
 &&=  \mathcal{D}_{1} + \mathcal{D}_{2} + \mathcal{D}_{3} + \mathcal{D}_{4} + \mathcal{D}_{5}
 \label{eq:NoseAndersen22.1}
 \\
 &\mathcal{D}_{1}
 &&=
 \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}}{ m_{i} V^{\frac{2}{3}}}
 \cdot \frac{\partial}{\partial \Tilde{\bm{r}}_{i}}
 +
 s \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{3m_{i} V^{\frac{5}{3}}}
 \frac{\partial}{\partial p_{V}}
 \label{eq:NoseAndersen22.2}
 \\
 &\mathcal{D}_{2}
 &&=
 s \frac{p_{V}}{W} \frac{\partial}{\partial V}
 \label{eq:NoseAndersen22.3}
 \\
 &\mathcal{D}_{3}
 &&=
 V^{\frac{1}{3}}  \sum_{i=1}^{N} \bm{F}_{i}
 \cdot \frac{\partial}{\partial \Tilde{\bm{p}}_{i}}
 +
  s \left(
          \frac{1}{3V} \sum_{i=1}^{N} \bm{F}_{i} \cdot \bm{r}_{i}
        - P_{\mathrm{eq}}
     \right)
  \frac{\partial}{\partial p_{V}}
 \label{eq:NoseAndersen22.4}
 \\
 &\mathcal{D}_{4}
 &&=
 \zeta \frac{\partial}{\partial \eta}
 -
 \zeta \sum_{i}^{N} \Tilde{\bm{p}}_{i} \cdot \frac{\partial}{\partial \Tilde{\bm{p}}_{i}}
 \label{eq:NoseAndersen22.5}
 \\
 &\mathcal{D}_{5}
 &&=
 \frac{1}{Q} \left(
                    \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}}
                   - g k_{B} T_{\mathrm{eq}}
	       \right)
  \frac{\partial}{\partial \zeta} 
 \label{eq:NoseAndersen22.6}
\end{alignat}
演算子$\mathcal{D}$を5つに分割したのに対応して, 鈴木・トロッター展開を用いて
時間発展演算子$e^{\mathcal{D} \Delta t}$を
\begin{equation}
 e^{\mathcal{D} \Delta t}
  =
  e^{\mathcal{D}_{5} \frac{\Delta t}{2}}
  e^{\mathcal{D}_{4} \frac{\Delta t}{2}}
  e^{\mathcal{D}_{3} \frac{\Delta t}{2}}
  e^{\mathcal{D}_{2} \frac{\Delta t}{2}}
  e^{\mathcal{D}_{1} \Delta t}
  e^{\mathcal{D}_{2} \frac{\Delta t}{2}}
  e^{\mathcal{D}_{3} \frac{\Delta t}{2}}
  e^{\mathcal{D}_{4} \frac{\Delta t}{2}}
  e^{\mathcal{D}_{5} \frac{\Delta t}{2}}
  +
  \mathcal{O}\left( (\Delta t)^{3} \right)
 \label{eq:NoseAndersen23}
\end{equation}
と分割する. 各時間発展演算子による位相空間の時間発展は以下の通りとなる. 
\begin{align}
 e^{\mathcal{D}_{1} \Delta t}
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) \\
  p_{V} (t) \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
 &=
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) + \frac{\Tilde{\bm{p}}_{i}(t)}{m_{i} V^{\frac{2}{3}}} \Delta t \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) \\
  p_{V} (t) + s \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}(t)}{3 m_{i} V^{\frac{5}{3}}} \Delta t \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
% \end{align}
% \begin{align}
 \label{eq:NoseAndersen24.1}
 \\
 e^{\mathcal{D}_{2} \Delta t}
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) \\
  p_{V} (t) \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
 &=
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) + s \frac{p_{V}}{W} \Delta t \\
  p_{V} (t) \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
   % \end{align}
 % \begin{align}
 \label{eq:NoseAndersen24.2}
 \\
 e^{\mathcal{D}_{3} \Delta t}
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) \\
  p_{V} (t) \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
 &=
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) + V^{\frac{1}{3}} \bm{F}_{i} (t) \Delta t \\
  V (t) \\
  p_{V} (t) + s \left( \frac{1}{3V} \sum_{i}^{N}
  \bm{F}_{i}(t) \cdot \bm{r}_{i}(t) - P_{\mathrm{eq}} \right) \Delta t \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
 % \end{align}
 % \begin{align}
 \label{eq:NoseAndersen24.3}
 \\
 e^{\mathcal{D}_{4} \Delta t}
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) \\
  p_{V} (t) \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
 &=
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) e^{- \zeta \Delta t} \\
  V (t) \\
  p_{V} (t) \\
  \eta (t) + \zeta \Delta t\\
  \zeta (t) \\
 \end{bmatrix}
 % \end{align}
 % \begin{align}
 \label{eq:NoseAndersen24.4}
 \\
 e^{\mathcal{D}_{5} \Delta t}
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) \\
  p_{V} (t) \\
  \eta (t) \\
  \zeta (t) \\
 \end{bmatrix}
 &=
 \begin{bmatrix}
  \Tilde{\bm{r}}_{i} (t) \\
  \Tilde{\bm{p}}_{i} (t) \\
  V (t) \\
  p_{V} (t) \\
  \eta (t) \\
  \zeta (t) + \frac{1}{Q}
  \left(
  \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}} - g k_{B} T_{\mathrm{eq}}
  \right) \Delta t \\
 \end{bmatrix}
 \label{eq:NoseAndersen24.5}
\end{align}
以上で得られた時間発展演算子を式(\ref{eq:NoseAndersen23})の順に作用させることで以下の時間発展アルゴリズムを得る. 
\begin{alignat}{2}
 & \zeta &&\gets  \zeta  + \frac{1}{Q}
                  \left(
                  \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}} - g k_{B} T_{\mathrm{eq}}
                  \right) \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.1}
 \\
 & \eta &&\gets \eta  + \zeta \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.2}
 \\
 & s &&\gets e^{\eta}
 \label{eq:NoseAndersen25.3}
 \\
 & \Tilde{\bm{p}}_{i} &&\gets \Tilde{\bm{p}}_{i}  e^{- \zeta \frac{\Delta t}{2}}
 \label{eq:NoseAndersen25.4}
 \\
 & \Tilde{\bm{p}}_{i} &&\gets \Tilde{\bm{p}}_{i}  + V^{\frac{1}{3}} \bm{F}_{i} 
                                  \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.4}
 \\
 & p_{V} &&\gets p_{V}  + s \left( \frac{1}{3V} \sum_{i=1}^{N}
                        \bm{F}_{i} \cdot \bm{r}_{i} - P_{\mathrm{eq}} \right) \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.6}
 \\
 & V &&\gets V + s \frac{p_{V}}{W} \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.7}
 \\
 & \Tilde{\bm{r}}_{i} &&\gets \Tilde{\bm{r}}_{i}
                                + \frac{\Tilde{\bm{p}}_{i}}{m_{i} V^{\frac{2}{3}}} \Delta t
 \label{eq:NoseAndersen25.8}
 \\
 & p_{V} &&\gets p_{V} + s \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{3 m_{i} V^{\frac{5}{3}}} \Delta t
 \label{eq:NoseAndersen25.9}
 \\
 & V &&\gets V  + s \frac{p_{V}}{W} \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.10}
 \\
 & \Tilde{\bm{p}}_{i} &&\gets \Tilde{\bm{p}}_{i} + V^{\frac{1}{3}} \bm{F}_{i} 
                                  \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.11}
 \\
 & p_{V} &&\gets p_{V} + s \left( \frac{1}{3V} \sum_{i=1}^{N}
                 \bm{F}_{i} \cdot \bm{r}_{i} - P_{\mathrm{eq}} \right) \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.12}
 \\
 & \eta &&\gets \eta  + \zeta \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.13}
 \\
 & s &&\gets e^{\eta}
 \label{eq:NoseAndersen25.14}
 \\
 & \Tilde{\bm{p}}_{i} &&\gets \Tilde{\bm{p}}_{i}  e^{- \zeta \frac{\Delta t}{2}} 
 \label{eq:NoseAndersen25.15}
 \\
 & \zeta &&\gets \zeta  + \frac{1}{Q}
                    \left(
                    \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}_{i}^{2}}{m_{i} V^{\frac{2}{3}}} - g k_{B} T_{\mathrm{eq}}
                    \right) \frac{\Delta t}{2}
 \label{eq:NoseAndersen25.16}
\end{alignat}

\clearpage

\section{Martyna・Tobias・Klein(MTK)の運動方程式}
前章では, 仮想時間・スケールされた座標による運動方程式を考えてきた.
ここでは Martyna・Tobias・Kleinによって提案された, 現実時間・非スケール座標による運動方程式を考える\cite{1994Martyna}.
Andersenの運動方程式
\begin{alignat}{3}
 \frac{d \Tilde{\bm{r}}_{i}}{d t}
  &= &&\frac{\partial \mathcal{H}_{\mathrm{A}}}{\partial \Tilde{\bm{p}}_{i}} &
  &= \frac{\Tilde{\bm{p}}_{i}}{m_{i} V^{\frac{2}{3}}}
 \label{eq:Andersen-r}
 \\
 \frac{d \Tilde{\bm{p}}_{i}}{d t}
  &= - &&\frac{\partial \mathcal{H}_{\mathrm{A}}}{\partial \Tilde{\bm{r}}_{i}}&
  &= - \frac{\partial U}{\partial \Tilde{\bm{r}}_{i}}
   =   V^{\frac{1}{3}} \bm{F}_{i}
 \label{eq:Andersen-p}
 \\
 \frac{d V}{d t}
  &= &&\frac{\partial \mathcal{H}_{\mathrm{A}}}{\partial p_{V}} &
 &= \frac{p_{V}}{W}
 \label{eq:Andersen-V}
 \\
 \frac{d p_{V}}{d t}
  &= - &&\frac{\partial \mathcal{H}_{\mathrm{A}}}{\partial V}  &
  &= \frac{1}{3V}
   \left(
         \sum_{i=1}^{N} \frac{\Tilde{\bm{p}}^{2}_{i}}{m_{i} V^{\frac{2}{3}}}
       + \sum_{i=1}^{N} \bm{F}_{i} \cdot \bm{r}_{i}
   \right)
   - P_{\mathrm{eq}}
 \label{eq:Andersen-pv}
\end{alignat}
をスケールをしていないデカルト座標で書き直すため, 次の変換を考える:
\begin{align}
 \Tilde{\bm{r}}_{i}       &= V^{-1/3} \bm{r}_{i} \\
 \dot{\Tilde{\bm{r}}}_{i} &= V^{-1/3} \dot{\bm{r}}_{i}
                           - \frac{1}{3} V^{-4/3} \dot{V} \bm{r}_{i} \\
 \Tilde{\bm{p}}_{i}       &= V^{\frac{1}{3}} \bm{p}_{i} \\
 \dot{\Tilde{\bm{p}}}_{i} &= V^{1/3} \dot{\bm{p}}_{i}
                           - \frac{1}{3} V^{-2/3} \dot{V} \bm{p}_{i}
\end{align}
アンダーセンの運動方程式(\ref{eq:Andersen-r})--(\ref{eq:Andersen-pv})に代入すると,
\begin{align}
 \dot{\bm{r}}_{i} &= \frac{\bm{p}_{i}}{m_{i}} + \frac{1}{3}\frac{\dot{V}}{V} \bm{r}_{i} \\
 \dot{\bm{p}}_{i} &= \bm{F}_{i} - \frac{1}{3}\frac{\dot{V}}{V} \bm{p}_{i} \\
 \dot{V}          &= \frac{p_{V}}{W} \\
 \dot{p_{V}}      &= \frac{1}{3V}
                     \left(
                             \sum_{i=1}^{N} \frac{\bm{p}^{2}_{i}}{m_{i}}
                           + \sum_{i=1}^{N} \bm{F}_{i} \cdot \bm{r}_{i}
                     \right)
                   - P_{\mathrm{eq}}
\end{align}
となる.
$\dot{V}/V$の繰り返しを避けるために
\begin{align}
 \epsilon \equiv \frac{1}{3} \ln \frac{V}{V_{0}}
\end{align}
を導入する.
$V_{0}$は参照体積であり, 例えば$t=0$における体積を設定する.
$\epsilon$に対する運動量$p_{\epsilon}$は
\begin{equation}
 \dot{\epsilon} = \frac{p_{\epsilon}}{W} = \frac{\dot{V}}{3V}
\end{equation}
によって定義される.
便利のため空間の次元を$d$とおいて,
\begin{align}
 \epsilon     = \frac{1}{d} \ln \frac{V}{V_{0}}, ~~~~~
 p_{\epsilon} = \frac{\dot{V}}{dV}
\end{align}
とすると$d$に対する運動方程式
\begin{align}
 \dot{\bm{r}}_{i} &= \frac{\bm{p}_{i}}{m_{i}} + \frac{p_{\epsilon}}{W} \bm{r}_{i} \\
 \dot{\bm{p}}_{i} &= \bm{F}_{i} - \frac{p_{\epsilon}}{W} \bm{p}_{i} \\
 \dot{V}          &= \frac{dV p_{\epsilon}}{W} \\
 \dot{p_{V}}      &= dV (P_{\mathrm{int}} - P_{\mathrm{eq}})
\end{align}
となる.
しかしながら, この運動方程式は正しいアンサンブルを生成しない. 
Martyna\cite{1994Martyna}らは運動量を次のようにスケールすることを提案した:
\begin{align}
  \dot{\bm{p}}_{i}   &= \Tilde{\bm{F}}_{i}
                      - \left(1 + \frac{d}{N_{f}} \right) \frac{p_{\epsilon}}{W} \bm{p}_{i} \\
  \dot{p}_{\epsilon} &= dV (P_{\mathrm{int}} - P_{\mathrm{eq}})
                      + \frac{d}{N_{f}} \sum_{i=1}^{N} \frac{\bm{p}_{i}^{2}}{m_{i}}
\end{align}
ここで$N_{f}$は拘束条件を差し引いた自由度で拘束条件の数$N_{c}$を用いて$(dN - N_{c})$で定義される.
$\Tilde{\bm{F}}_{i}$は拘束力を含めた原子$i$に加わる力である.
この運動方程式に, 能勢・Hooverの熱浴を組み合わせることで定温定圧アンサンブルを実現できる.


\bibliographystyle{junsrt}
\bibliography{temperature-pressure-control}
\input{../include/end}
